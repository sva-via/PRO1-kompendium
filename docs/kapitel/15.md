# Kapitel 15 – Clock – repræsentationsvalg

## 1. Introduktion

I dette kapitel analyserer vi designet af en Clock-klasse. Fokus er ikke blot funktionalitet, men valg af intern repræsentation.

Skal tiden gemmes som hour/minute/second eller som totalSeconds? Valget påvirker invariants, normalisering og implementering af metoder som timeTo.

## 2. totalSeconds vs hour/min/sec

Repræsentation A: Tre felter.

```
private int hour;
private int minute;
private int second;
```
Invariant:
- 0 <= hour < 24
- 0 <= minute < 60
- 0 <= second < 60

Repræsentation B: Ét felt.

```
private int totalSeconds;
```
Invariant:
- 0 <= totalSeconds < 86400

Begge repræsentationer modellerer samme domæne – men med forskellige konsekvenser.

## 3. Normalisering

Normalisering betyder at sikre, at repræsentationen overholder invarianten efter enhver ændring.

```
public void tick() {
    totalSeconds++;
    if (totalSeconds == 86400) {
        totalSeconds = 0;
    }
}
```
Her er normalisering enkel: vi sikrer, at totalSeconds aldrig overstiger 86399.

Ved hour/min/sec-repræsentation kræves mere kompleks normalisering.

```
public void tick() {

    second++;

    if (second == 60) {
        second = 0;
        minute++;
    }

    if (minute == 60) {
        minute = 0;
        hour++;
    }

    if (hour == 24) {
        hour = 0;
    }
}
```
Flere felter medfører flere grænser, der skal håndteres korrekt.

## 4. timeTo og wrap-around

Metoden timeTo beregner antal sekunder til et andet Clock-objekt.

Wrap-around betyder, at tiden kan passere midnat.

```
public int timeTo(Clock other) {

    int diff = other.totalSeconds - this.totalSeconds;

    if (diff < 0) {
        diff += 86400;
    }

    return diff;
}
```
Her håndteres wrap-around ved at lægge et døgn til, hvis forskellen er negativ.

## 5. Designovervejelser

Fordele ved totalSeconds:
- Én invariant
- Enkel normalisering
- Simpel beregning i timeTo

Fordele ved hour/min/sec:
- Mere direkte læsbar repræsentation
- Let adgang til visning

Valget bør baseres på, hvilke operationer der er centrale i domænet.

## 6. Typiske fejl og misforståelser

1) At ignorere wrap-around ved midnat.
2) At bryde invarianten midlertidigt.
3) At duplikere normaliseringslogik flere steder.
4) At vælge repræsentation uden at analysere domænebehov.

## 7. Refleksionsspørgsmål

1) Hvilken repræsentation giver færrest invariants?
2) Hvordan påvirker repræsentationsvalget kompleksiteten af tick?
3) Hvornår er wrap-around en vigtig del af domænet?

## 8. Små øvelser

Øvelse 1: Implementér Clock med hour/minute/second og sammenlign med totalSeconds.

Øvelse 2: Udvid Clock med en metode addSeconds(int s) og håndtér wrap-around korrekt.
