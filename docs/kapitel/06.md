# Kapitel 6 – Exceptions som designværktøj

## 1. Introduktion

Exceptions er ikke blot en teknisk mekanisme i Java. De er et designværktøj.

Når en invariant brydes, eller når en metode ikke kan udføre sit ansvar, skal systemet reagere tydeligt og kontrolleret.

I dette kapitel ser vi på strict vs tolerant design, IllegalArgumentException, IllegalStateException og fejlpolitik som arkitekturbeslutning.

## 2. Strict vs tolerant design

Strict design afviser ugyldige input og stopper eksekveringen med en exception.
Tolerant design forsøger at rette eller ignorere fejlen.

```
public MyDate(int year, int month, int day) {
    if (!isValidDate(year, month, day)) {
        throw new IllegalArgumentException("Invalid date");
    }
    this.year = year;
    this.month = month;
    this.day = day;
}
```
Her anvendes strict design: objektet oprettes ikke, hvis input er ugyldigt.

## 3. IllegalArgumentException

IllegalArgumentException bruges, når en metode modtager et argument, der bryder dens kontrakt.

```
public void setMonth(int month) {
    if (month < 1 || month > 12) {
        throw new IllegalArgumentException("Month must be between 1 and 12");
    }
    this.month = month;
}
```
Exceptionen signalerer, at fejlen ligger hos kaldende kode.

## 4. IllegalStateException

IllegalStateException bruges, når objektets interne tilstand gør en operation ulovlig.

```
public void withdraw(double amount) {
    if (amount > balance) {
        throw new IllegalStateException("Insufficient funds");
    }
    balance -= amount;
}
```
Her er argumentet ikke nødvendigvis ulovligt – men objektets tilstand tillader ikke handlingen.

## 5. Gennemgående eksempel – MyDate

```
public void stepForwardOneDay() {

    day++;

    if (!isValidDate(year, month, day)) {
        day = 1;
        month++;

        if (month > 12) {
            month = 1;
            year++;
        }
    }
}
```
Hvis invarianten ikke kan bevares, bør metoden reagere med en exception frem for stiltiende at fortsætte.

## 6. Fejlpolitik som arkitekturbeslutning

Fejlpolitik handler om, hvordan systemet generelt håndterer fejl.

Spørgsmål man bør stille:
- Skal fejl stoppes med det samme?
- Skal de logges og ignoreres?
- Skal de omsættes til brugerbeskeder?

Domæneklasser bør typisk anvende strict design og kaste exceptions, mens håndtering sker i et højere lag af arkitekturen.

## 7. Designovervejelser

Exceptions bør beskytte invarianten og tydeliggøre kontrakter.
Undgå at bruge exceptions til almindelig kontrolflow.
Fejl bør opdages så tidligt som muligt.

## 8. Typiske fejl og misforståelser

1) At ignorere exceptions.
2) At returnere null i stedet for at kaste exception.
3) At bruge IllegalStateException i stedet for IllegalArgumentException (eller omvendt).
4) At skjule fejl i tolerant design uden klar begrundelse.

## 9. Refleksionsspørgsmål

1) Hvornår er strict design at foretrække?
2) Hvad er forskellen på IllegalArgumentException og IllegalStateException?
3) Hvor i arkitekturen bør exceptions håndteres?

## 10. Små øvelser

Øvelse 1: Tilføj validering i en Account-klasse, så negative indbetalinger afvises.

Øvelse 2: Identificér i et eksisterende design, hvor fejl burde håndteres højere i arkitekturen.
