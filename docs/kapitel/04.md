# Kapitel 4 – Konstruktører og gyldig tilstand

## 1. Introduktion

En invariant beskriver, hvad der altid skal være sandt for et objekt. Dette ansvar begynder ved konstruktionen.

Et objekt skal være gyldigt fra det øjeblik, det oprettes. Der må ikke eksistere en fase, hvor objektet er halvfærdigt.

## 2. Objektet skal være gyldigt fra start

```
public class MyDate {

    private int year;
    private int month;
    private int day;

    public MyDate() {
    }

    public void setYear(int year) {
        this.year = year;
    }

    public void setMonth(int month) {
        this.month = month;
    }

    public void setDay(int day) {
        this.day = day;
    }
}
```
Her kan objektet eksistere uden at repræsentere en gyldig dato. Invarianten er ikke håndhævet.

## 3. Konstruktorens ansvar

```
public MyDate(int year, int month, int day) {

    if (!isValidDate(year, month, day)) {
        throw new IllegalArgumentException("Invalid date");
    }

    this.year = year;
    this.month = month;
    this.day = day;
}
```
Her anvendes IllegalArgumentException til at afvise input, der bryder invarianten.

## 4. Ingen to-trins-konstruktion

```
MyDate d = new MyDate();
d.setYear(2024);
d.setMonth(2);
d.setDay(31);
```
Objektet overlader her korrekt brug til klientkoden. Det er et brud på objektets ansvar.

## 5. Constructor overloading

```
public MyDate(int year, int month, int day) {
    if (!isValidDate(year, month, day)) {
        throw new IllegalArgumentException("Invalid date");
    }
    this.year = year;
    this.month = month;
    this.day = day;
}

public MyDate(int year) {
    this(year, 1, 1);
}
```
Den sekundære konstruktor delegere til den primære via this(...). Valideringen samles ét sted.

## 6. Sammensatte objekter

```
public class Person {

    private MyDate birthDate;

    public Person(MyDate birthDate) {
        this.birthDate = birthDate;
    }
}
```
Hvis MyDate er mutable, kan ekstern kode ændre Person indirekte.

## 7. Defensive copying (intro)

```
public Person(MyDate birthDate) {

    this.birthDate = new MyDate(
        birthDate.getYear(),
        birthDate.getMonth(),
        birthDate.getDay()
    );
}
```
Ved at oprette en kopi beskytter objektet sin interne repræsentation.

## 8. Designovervejelser

En konstruktor skal kunne sikre invarianten fuldt ud. Hvis objektet kan eksistere i halvfærdig tilstand, er designet svagt.

## 9. Refleksionsspørgsmål

1) Hvorfor er to-trins-konstruktion problematisk?
2) Hvorfor bør sekundære konstruktører delegere?
3) Hvornår er defensive copying nødvendig?

## 10. Små øvelser

Øvelse 1: Implementér en konstruktor MyDate(int year, int month) med day = 1.

Øvelse 2: Design en konstruktor til Course med startDate som parameter.
